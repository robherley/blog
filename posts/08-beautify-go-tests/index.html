<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>ðŸŽ¨ Beautify your Go tests on GitHub Actions | rob's blog</title><link rel=icon type=image/png href=https://blog.reb.gg/images/logo.png>
<link rel=stylesheet href=/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=" crossorigin=anonymous><link rel=stylesheet href=/css/article.min.3d68b337d54382250563c3c74528261d25b316f1df232ec198665d91e6621ba7.css integrity="sha256-PWizN9VDgiUFY8PHRSgmHSWzFvHfIy7BmGZdkeZiG6c=" crossorigin=anonymous><link rel=stylesheet href=/css/fonts.min.e0bf373169e09cf6dfc780f970638fcd39a5898dcecb6c9286f170d5907dbbf5.css integrity="sha256-4L83MWngnPbfx4D5cGOPzTmliY3Oy2yShvFw1ZB9u/U=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.a99e7b40557c65a8aaa63ef4a655897fcf2f50744c881928d760edc27bb27fed.css integrity="sha256-qZ57QFV8Zaiqpj70plWJf88vUHRMiBko12Dtwnuyf+0=" crossorigin=anonymous><link rel=stylesheet href=/css/simple-icons.min.min.8e53216f6540542c220ed40839d164fb18b299e5d70551cb60b0600d3f0a011f.css integrity="sha256-jlMhb2VAVCwiDtQIOdFk+xiymeXXBVHLYLBgDT8KAR8=" crossorigin=anonymous><style>:root{--color-primary:var(--color-blue-6)}</style><script src=/js/main.ec400c542ae0486a91bf8b446dfa1a0efef0138bc2c68a10a83338aca6279b96.js integrity="sha256-7EAMVCrgSGqRv4tEbfoaDv7wE4vCxooQqDM4rKYnm5Y=" crossorigin=anonymous></script><script type=module>
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script></head><body><header><h1 class=site-title><span role=img aria-label=emoji-logo>ðŸ’¾
</span><a href=https://blog.reb.gg/>rob's blog</a></h1><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li></ul></nav></header><main><article><h1 class=title>ðŸŽ¨ Beautify your Go tests on GitHub Actions</h1><div class=meta><time datetime=2022-07-23T00:51:58-04:00>July 23, 2022</time> &#183; 3 min read</div><div class=tags><a class=tag href=/tags/golang/>Golang</a>
<a class=tag href=/tags/testing/>Testing</a>
<a class=tag href=/tags/github/>Github</a>
<a class=tag href=/tags/actions/>Actions</a></div><div class=markdown-body><h2 id=was-this-made-for-humans><a href=#was-this-made-for-humans>#</a>
Was this made for humans?</h2><p>Although simple, Go&rsquo;s default testing output leaves a lot to be desired:</p><p><img src=/content/beautify-go-tests/gotest.png alt="go test output"></p><p>This has led rise to some other wrappers for <code>go test</code>, solely to be a better formatter for humans. For example, <a href=https://github.com/gotestyourself/gotestsum><code>gotestsum</code></a> does this quite well:</p><p><img src=/content/beautify-go-tests/gotestsum.png alt="gotestsum output"></p><p>This is definitely an improvement, and <code>gotestsum</code> even has additional formatting like exporting to JUnit XML.</p><p>But, what if CI could produce a rich, interactive, summary like this:</p><p><img src=/content/beautify-go-tests/gotestaction.png alt="gotestaction overview"></p><p>And interactive expansion for more details:</p><p><img src=/content/beautify-go-tests/gotestaction2.png alt="gotestaction expansion"></p><p>(Check out the <a href=https://github.com/robherley/go-test-example/actions/runs/2725452630/attempts/1#summary-7484360764>example here</a>!)</p><h2 id=actions-job-summaries><a href=#actions-job-summaries>#</a>
Actions Job Summaries</h2><p>One of the great features my team released recently was GitHub Actions <a href=https://github.blog/2022-05-09-supercharging-github-actions-with-job-summaries/>Job Summaries</a>. If you haven&rsquo;t heard of it yet, it&rsquo;s a very simple way to get Markdown content as an output for a GitHub Actions job.</p><p>It&rsquo;s relatively easy to use, we provide two mechanisms to write summary content:</p><ol><li>Writing <a href=https://github.github.com/gfm/>GitHub Flavored Markdown</a> to the file at <code>$GITHUB_STEP_SUMMARY</code> on all GitHub Actions runners.</li><li>Utilizing the <code>@actions/core</code>&rsquo;s TypeScript <a href=https://github.com/actions/toolkit/blob/main/packages/core/src/summary.ts>helper library</a>.</li></ol><p>And the latter is what I used to create <a href=https://github.com/robherley/go-test-action><code>go-test-action</code></a>.</p><h2 id=introducing-go-test-action><a href=#introducing-go-test-action>#</a>
Introducing: <code>go-test-action</code></h2><p>It should be easy to get a pretty test summary.</p><p>With <code>go-test-action</code>, all you need is to replace <em>one line</em> in your Actions Workflow:</p><div class=highlight><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>name: CI
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on:
</span></span><span style=display:flex><span>  push:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jobs:
</span></span><span style=display:flex><span>  test:
</span></span><span style=display:flex><span>    runs-on: ubuntu-latest
</span></span><span style=display:flex><span>    steps:
</span></span><span style=display:flex><span>    - uses: actions/checkout@v3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - name: Set up Go
</span></span><span style=display:flex><span>      uses: actions/setup-go@v3
</span></span><span style=display:flex><span>      with:
</span></span><span style=display:flex><span>        go-version: 1.18
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - name: Build
</span></span><span style=display:flex><span>      run: go build -v ./...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - name: Test
</span></span><span style=display:flex><span><span style=color:#e78284;background-color:#414559>-     run: go test ./...
</span></span></span><span style=display:flex><span><span style=color:#e78284;background-color:#414559></span><span style=color:#a6d189;background-color:#414559>+     uses: robherley/go-test-action@v0.1.0
</span></span></span></code></pre></div><p>If your test parameters are a bit more complicated or if you want to customize the summary structure, there are a few <a href=https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepswith>inputs</a> that you can use:</p><table><thead><tr><th style=text-align:left>Input</th><th style=text-align:left>Default</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>moduleDirectory</td><td style=text-align:left><code>.</code></td><td style=text-align:left>relative path to the directory containing the <code>go.mod</code> of the module you wish to test</td></tr><tr><td style=text-align:left>testArguments</td><td style=text-align:left><code>./...</code></td><td style=text-align:left>arguments to pass to <code>go test</code>, <code>-json</code> will be prepended automatically</td></tr><tr><td style=text-align:left>omitUntestedPackages</td><td style=text-align:left><code>false</code></td><td style=text-align:left>omit any go packages that don&rsquo;t have any tests from the summary output</td></tr><tr><td style=text-align:left>omitPie</td><td style=text-align:left><code>false</code></td><td style=text-align:left>omit the pie chart from the summary output</td></tr></tbody></table><p>So if you really hate ðŸ¥§, you can change your Workflow to omit it:</p><div class=highlight><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    - <span style=color:#ca9ee6>name</span>: Test
</span></span><span style=display:flex><span>      <span style=color:#ca9ee6>uses</span>: robherley/go-test-action@v0.1.0
</span></span><span style=display:flex><span>      <span style=color:#ca9ee6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ca9ee6>omitPie</span>: <span style=color:#ef9f76>true</span>
</span></span></code></pre></div><p>For the most up-to-date list of inputs, check out the <a href=https://github.com/robherley/go-test-action/blob/main/action.yml>action.yml</a></p><h2 id=but-how-does-it-work><a href=#but-how-does-it-work>#</a>
But how does it work?</h2><p>When executing the tests, <code>go-test-action</code> will prepend the arguments with <code>-json</code>, that will convert the output to JSON using <a href=https://pkg.go.dev/cmd/test2json>test2json</a>.</p><p>The <code>test2json</code> JSON output is structured like so:</p><div class=highlight><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#e78284>type</span> TestEvent <span style=color:#e78284>struct</span> {
</span></span><span style=display:flex><span>	Time    time.Time
</span></span><span style=display:flex><span>	Action  <span style=color:#e78284>string</span>
</span></span><span style=display:flex><span>	Package <span style=color:#e78284>string</span>
</span></span><span style=display:flex><span>	Test    <span style=color:#e78284>string</span>
</span></span><span style=display:flex><span>	Elapsed <span style=color:#e78284>float64</span>
</span></span><span style=display:flex><span>	Output  <span style=color:#e78284>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The actual output is a bit chunky:</p><div class=highlight><pre tabindex=0 style=color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.92576-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;output&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example&#34;</span>,<span style=color:#ca9ee6>&#34;Output&#34;</span>:<span style=color:#a6d189>&#34;?   \tgithub.com/robherley/go-test-example\t[no test files]\n&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.926603-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;skip&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example&#34;</span>,<span style=color:#ca9ee6>&#34;Elapsed&#34;</span>:<span style=color:#ef9f76>0.001</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931066-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;run&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931141-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;output&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess&#34;</span>,<span style=color:#ca9ee6>&#34;Output&#34;</span>:<span style=color:#a6d189>&#34;=== RUN   TestSuccess\n&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931166-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;run&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(1)&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931185-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;output&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(1)&#34;</span>,<span style=color:#ca9ee6>&#34;Output&#34;</span>:<span style=color:#a6d189>&#34;=== RUN   TestSuccess/Subtest(1)\n&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931204-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;output&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(1)&#34;</span>,<span style=color:#ca9ee6>&#34;Output&#34;</span>:<span style=color:#a6d189>&#34;    success_test.go:19: hello from subtest #1\n&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931239-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;run&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(2)&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931284-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;output&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(2)&#34;</span>,<span style=color:#ca9ee6>&#34;Output&#34;</span>:<span style=color:#a6d189>&#34;=== RUN   TestSuccess/Subtest(2)\n&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.9313-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;output&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(2)&#34;</span>,<span style=color:#ca9ee6>&#34;Output&#34;</span>:<span style=color:#a6d189>&#34;    success_test.go:19: hello from subtest #2\n&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#ca9ee6>&#34;Time&#34;</span>:<span style=color:#a6d189>&#34;2022-07-10T22:42:11.931315-04:00&#34;</span>,<span style=color:#ca9ee6>&#34;Action&#34;</span>:<span style=color:#a6d189>&#34;run&#34;</span>,<span style=color:#ca9ee6>&#34;Package&#34;</span>:<span style=color:#a6d189>&#34;github.com/robherley/go-test-example/success&#34;</span>,<span style=color:#ca9ee6>&#34;Test&#34;</span>:<span style=color:#a6d189>&#34;TestSuccess/Subtest(3)&#34;</span>}
</span></span><span style=display:flex><span><span style=color:#737994;font-style:italic>// and more!
</span></span></span></code></pre></div><p>This JSON output is parsed, grouped and aggregated like so:</p><ul><li>For every <em>package level</em> test, group the following:<ul><li>Count tests that have a <em>conclusive</em> attribute. Conclusive meaning their <code>test2json</code> output <code>Action</code> is either is <code>pass</code>, <code>fail</code> or <code>skip</code>.</li><li>Repeat above for any subtests with a test (subtests in go with <a href=https://pkg.go.dev/testing#hdr-Subtests_and_Sub_benchmarks><code>T.Run</code></a> are naively indicated with a <code>/</code> in their name)</li></ul></li></ul><p>This logic is split between the <a href=https://github.com/robherley/go-test-action/blob/6a4c0a24d1b6c6df89b9aa634ac98682e4dedced/src/events.ts#L46><code>parseTestEvents</code></a> function and the <a href=https://github.com/robherley/go-test-action/blob/6a4c0a24d1b6c6df89b9aa634ac98682e4dedced/src/results.ts#L11><code>PackageResult</code></a> class. And once it&rsquo;s all parsed, the attributes are rendered to Markdown by the <a href=https://github.com/robherley/go-test-action/blob/6a4c0a24d1b6c6df89b9aa634ac98682e4dedced/src/renderer.ts#L14><code>Renderer</code></a> class.</p><h2 id=contribute><a href=#contribute>#</a>
Contribute!</h2><p>Have an idea for a feature or want to report a bug? Feel free to open an <a href=https://github.com/robherley/go-test-action/issues>issue</a> or submit a <a href=https://github.com/robherley/go-test-action/pulls>pull request</a>!</p><p>Thanks for reading and happy testing! ðŸ§ª</p></div></article><div class=prev-next><div><a href=https://blog.reb.gg/posts/07-go-tiny-coffee/>&#8592; Prev</a>
<span>â˜• Rewriting tiny.coffee to &lt; 100 lines â€¦</span></div></div></main><footer><div class=stripes></div><div class=footer-meta><div><div>2024 Rob Herley</div><div>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> &
      <a href=https://github.com/robherley/rebugo target=_blank rel="noopener noreferrer">robherley/rebugo</a></div></div><div class=socials><a href=https://github.com/robherley rel=author title=github><i class="si si-github"></i></a><a href=https://x.com/robherley rel=author title=x><i class="si si-x"></i></a><a href=https://instagram.com/robherley rel=author title=instagram><i class="si si-instagram"></i></a><a href=https://www.linkedin.com/in/robherley/ rel=author title=linkedin><i class="si si-linkedin"></i></a></div></div></footer></body></html>